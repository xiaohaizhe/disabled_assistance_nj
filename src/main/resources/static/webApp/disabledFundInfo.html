<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>资金申请明细</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style>
        html {
            background-color: #F4F6F9;
        }
        .grid-project {
            padding: 10px;
        }
        .project-info {
            height: 180px;
            background-color: #fff;
            padding: 10px;
        }
        .nav-title {
            background-color: #fff;
            padding: 20px;
            border-bottom: 1px solid #ccc;
            font-size: 18px;
        }
        .bold-text {
            font-weight: bold;
            font-size: 36px;
            color: #f0ad4e;
        }
        .numbers {
            padding: 10px;
        }
        .numbers > p{
            font-size: 20px;
            margin-top: 10px;
            text-align: center;
        }
        .table-box {
            background-color: #fff;
            padding: 10px;
        }
        .layui-form-pane .layui-form-label{
            width: 200px;
        }
        .layui-form-pane .layui-input-block {
            margin-left: 200px;
        }
    </style>
</head>
<body>
<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<div class="nav-title">残疾人托养服务补贴资金申请明细</div>
<div class="layui-fluid">
    <div style="padding: 10px;">
        <div class="table-box">
            <p>残疾人托养服务补贴资金申请</p>
            <table id="demo" lay-filter="test"></table>
        </div>
    </div>
</div>
<div id="editPanel" class="modal" style="display: none">
    <form class="layui-form layui-form-pane" lay-filter="edit-form" action="" target="asyncSubmieForm"
          style="margin-top:15px;">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">审核状态</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="spzt" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">机构名称</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="adminName" class="layui-input" disabled>
                </div>
            </div>

        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">登记注册时间</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="registrationTime" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">更新时间</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="lastModifyTime" class="layui-input" disabled>
                </div>

            </div>

        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">负责人</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="personInCharge" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">机构面积</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="area" class="layui-input" disabled>
                </div>
            </div>

        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">床位数</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="bedNum" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">机构性质</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="nature" class="layui-input" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">庇护性劳动项目</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="asylumLaborProjects" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">符合条件的全托人数</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="numOfEligibleDayNursery" class="layui-input" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">符合条件的日托人数</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="numOfEligibleBoardingNursery" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">申请机构全托运营补贴资金总额</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="subsidyFundForBoardingNursery" class="layui-input" disabled>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">上年当地资金投入情况</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="localInvestmentOfLastYear last_year" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">申请托养机构运营补贴资金总额合计</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="totalSubsidyFunds" class="layui-input" disabled>
                </div>
            </div>

        </div>
        <!--<div class="layui-form-item">-->
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">托养残疾人名单</label>-->
                <!--<div class="layui-input-block" style="padding-right:15px;">-->
                    <!--<input type="text" name="nursingList" class="layui-input" disabled>-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">低保或其他低收入证明</label>-->
                <!--<div class="layui-input-block" style="padding-right:15px;">-->
                    <!--<input type="text" name="lowIncomeCertificate" class="layui-input" disabled>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">提交人</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="adminName" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">提交时间</label>
                <div class="layui-input-block" style="padding-right:15px;">
                    <input type="text" name="createTime" class="layui-input" disabled>
                </div>
            </div>

        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地址</label>
            <div class="layui-input-block" style="padding-right:15px;">
                <input type="text" name="address" class="layui-input" disabled>
            </div>
        </div>
        <!--<div class="layui-form-item" style="min-height: 100px;">-->
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">托养残疾人名单</label>-->
                <!--<div id="cjrmd"  class="layui-input-block" style="padding-right:15px;">-->
                <!--</div>-->
            <!--</div>-->
            <!--<div class="layui-inline">-->
                <!--<label class="layui-form-label">低保或其他低收入证明</label>-->
                <!--<div id="dsrzm" class="layui-input-block" style="padding-right:15px;">-->
                <!--</div>-->
            <!--</div>-->

        <!--</div>-->
        <div class="layui-form-item" style="text-align: center;">
            <button onclick="agreefn()" type="button" class="layui-btn detail-btn" style="width: 100px;">同意</button>
            <button onclick="refusefn()" type="button" class="layui-btn detail-btn layui-btn-danger" style="width: 100px;">拒绝</button>
            <button onclick="exportfile()" type="button" class="layui-btn layui-btn-normal" style="width: 100px;">生成word</button>
        </div>
    </form>
</div>

<script src="../layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">审核</a>
</script>
<script>
    var pageid = "";
    var tableIns = null;
    var quotaIndex = null;
    var _ORGID = "";
    var _APPLYID = "";

    function agreefn() {
        $.ajax({
            type: "GET",
            url: "/api/apply/changeStatusToApproval?adminId=1&id="+pageid,
            dataType:"json",
            contentType : 'application/json;charset=utf-8',
            processData: false,
            success: function (data) {
                layer.alert(data.msg, {icon: 1});
                tableIns.reload();
                layer.close(quotaIndex);
            },
            error:function () {
                layer.alert('操作失败', {icon: 2});
            }
        })
    }

    function refusefn(){
        var str=prompt("请输入拒绝理由","")
        if (str!=null && str!="")
        {
            $.ajax({
                type: "GET",
                url: "/api/apply/changeStatusToRejection?adminId=1&id="+pageid+'&reason='+str,
                dataType:"json",
                contentType : 'application/json;charset=utf-8',
                processData: false,
                success: function (data) {
                    layer.alert(data.msg, {icon: 1});
                    tableIns.reload();
                    layer.close(quotaIndex);
                },
                error:function () {
                    layer.alert('操作失败', {icon: 2});
                }
            })
        }
    }

    layui.use(['table','form','layer'], function(){
        var table = layui.table;
        var form = layui.form;
        $ = layui.$;
        var layer = layui.layer;
        //第一个实例
        tableIns = table.render({
            elem: '#demo'
            ,height: 600
            ,url: '/api/apply/getPageByOrganization'+location.search+'&sorts=modifyTime' //数据接口
            , request: {
                pageName: 'page', //页码的参数名称，默认：page
                limitName: 'number' //每页数据量的参数名，默认：limit
            }
            , response: {
                statusCode: 200 //重新规定成功的状态码为 200，table 组件默认为 0
            }
            , parseData: function (res) { //将原始数据解析成 table 组件所规定的数据
                return {
                    "code": 200, //解析接口状态
                    //                    "msg": res.message, //解析提示文本
                    //                     "count": res.total, //解析数据长度
                    "data": res.data //解析数据列表
                };
            }
            ,page: true //开启分页
            ,cols: [[ //表头
                {field: 'status', title: '审核状态', width:200, sort: true, fixed: 'left',templet: function(d){
                        return ["删除","待审批","已审批","已拒绝"][d.status]
                    }}
                ,{field: 'adminName', title: '机构名称', width:180, sort: true}
                ,{field: 'registrationTime', title: '登记注册时间', width:180, sort: true}
                ,{field: 'address', title: '地址', width:380, sort: true}
                ,{field: 'personInCharge', title: '负责人', width: 177, sort: true}
                ,{field: 'area', title: '机构面积', width: 280, sort: true}
                ,{field: 'bedNum', title: '床位数', width: 280, sort: true}
                ,{field: 'nature', title: '机构性质', width: 180, sort: true}
                ,{field: 'asylumLaborProjects', title: '庇护性劳动项目', width: 135, sort: true}
                ,{field: 'numOfEligibleDayNursery', title: '符合条件的日托人数', width: 135, sort: true}
                ,{field: 'numOfEligibleBoardingNursery', title: '符合条件的全托人数', width: 180, sort: true}
                ,{field: 'subsidyFundForBoardingNursery', title: '申请机构全托运营补贴资金总额', width: 235, sort: true}
                ,{field: 'localInvestmentOfLastYear', title: '上年当地资金投入情况', width: 235, sort: true}
                ,{field: 'totalSubsidyFunds', title: '申请托养机构运营补贴资金总额合计', width: 235, sort: true}
                ,{field: 'nursingList', title: '托养残疾人名单', width: 135, sort: true ,templet: function(d){
                        return smail(d.nursingList);
                    }}
                ,{field: 'lowIncomeCertificate', title: '低保或其他低收入证明', width: 135, sort: true ,templet: function(d){
                        return smail(d.lowIncomeCertificate);
                    }}
                ,{field: 'adminName', title: '提交人', width: 135, sort: true}
                ,{field: 'createTime', title: '提交时间', width: 135, sort: true}
                ,{field: 'lastModifyTime', title: '更新时间', width: 135, sort: true}
                ,{fixed: 'right', width: 120, align:'center', toolbar: '#barDemo'}

            ]]
        });


        function smail(str){
            if(str){
                if(str.indexOf(".jpg") != -1 || str.indexOf(".png") != -1){
                    return '<img src="'+str+'" style="width: 30px;">'
                }else if(str.indexOf(".doc") != -1 || str.indexOf(".docx") != -1){
                    return '<img src="../images/word.png" style="width: 30px;">'
                }else if(str.indexOf(".xls") != -1 || str.indexOf(".xlsx") != -1){
                    return '<img src="../images/xls.png" style="width: 30px;">'
                }else {
                    return '<img src="'+str+'" style="width: 30px;">'
                }
            }else {
                return "";
            }

        }

        function setDown(dom,str){
            if(str){
                if(str.indexOf(".jpg") != -1 || str.indexOf(".png") != -1){
                    dom.html('<a target="_blank" href="'+str+'"><img src="'+str+'" style="width: 100px;"></a>')
                }else if(str.indexOf(".doc") != -1 || str.indexOf(".docx") != -1){
                    dom.html('<a target="_blank" href="'+str+'"><img src="../images/word.png" style="width: 100px;"></a>')
                }else if(str.indexOf(".xls") != -1 || str.indexOf(".xlsx") != -1){
                    dom.html('<a target="_blank" href="'+str+'"><img src="../images/xls.png" style="width: 100px;"></a>')
                }
            }
        }

        //监听行工具事件
        table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data //获得当前行数据
                ,layEvent = obj.event; //获得 lay-event 对应的值
            pageid = data.id;
            setDown($("#dsrzm"),data.lowIncomeCertificate);
                setDown($("#cjrmd"),data.nursingList);
            if(layEvent === 'edit'){
                 quotaIndex = layer.open({
                    type: 1,
                    title: "残疾人托养服务补贴资金申请",
                    content: $("#editPanel").html(),
                    area: ['1000px', '700px'],
                    success: function(layero, index){
                        if(data.status != 1){
                            $(".detail-btn").hide();
                        }else {
                            $(".detail-btn").show();
                        }
                    }
                });
                data.spzt = ["删除","待审批","已审批","已拒绝"][data.status];
                _APPLYID = data.id;
                form.render();
                form.val("edit-form", data);

            }
            obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');

        });


    });

    function exportfile() {
        _ORGID = location.search.split("=")[1];
        window.location = "/api/org/export_word?orgId="+_ORGID+"&applyId="+_APPLYID;
    }
</script>

</body>
</html>