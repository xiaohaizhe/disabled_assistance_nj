<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../../layui/css/layui.css" media="all">
	<link rel="stylesheet" href="../../css/init.css">
	<link rel="stylesheet" href="../../css/search_form.css">
	<style>
		.container {
			width: 100%;
		}
		.title {
			font-size: 18px;
			color: #888;
			padding: 5px;
		}
		.main {
			padding: 10px;
			background-color: #eee;
		}
		.count,.analysis,.chart {
			width: 100%;
			height: 300px;
			margin-top: 20px;
		}
		.subTitle {
			font-size: 16px;
			color: #000;
			background-color: #F0F8FF;
			padding: 5px 10px;
		}
		.toggleData {
			float: right;
		}
		.toggleData >span {
			margin-left: 20px;
			cursor: pointer;
		}
		.toggleData >.active {
			color: #3399ff;
		}
		.subContent {
			width: 100%;
			height: 270px;
		}
		.count .left {
			width: 55%;
			height: 100%;
			padding-top: 30px;
			position: relative;
			background-color: #fff;
		}
		.count .right {
			width: 45%;
			height: 100%;
			position: relative;
		}
		.leftTitle {
			font-weight: bold;
			position: absolute;
			left: 10px;
			top: 5px;
			font-size: 16px;
		}
		.leftContent {
			width: 100%;
		}
		.rightContent {
			width: 100%;
			height: 240px;
		}
		.leftContent:after {
			content: "";
			display: block;
			clear: both;
		}
		.leftContent >div {
			float: left;
			width: 33%;
			height: 120px;
		}
		.card {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}
		.card img {
			width: 18px;
			height: 18px;
		}
		.card .card_value {
			color: #1E90FF;
		}
		.card_value>.value {
			font-size: 30px;
			font-weight: bold;
		}
		.chart .left {
			width: 50%;
			height: 100%;
		}
		.chart .right {
			width: 50%;
			height: 100%;
			background-color: #AAAAAA;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 10px 30px;
		}
		.right .legend {
			display: flex;
			justify-content: space-between;
			padding: 5px;
			border-bottom: 1px solid #555555;
			width: 100%;
		}
		.legend .color {
			display: inline-block;
			width: 30px;
			line-height: 30px;
			text-align: center;
			font-size: 20px;
			font-weight: bold;
			color: #fff;
			border-radius: 3px;
		}
		.color_one {
			background-color: #97FFFF;
		}
		.color_two {
			background-color: #6CA6CD;
		}
		.color_three {
			background-color: #EEB422;
		}
		.color_four {
			background-color: #FF83FA;
		}
		.color_five {
			background-color: #9F79EE;
		}
	</style>
</head>
<body>
<div class="container">
	<div class="title">领导驾驶舱</div>
	<div class="main">
		<div class="count">
			<div class="subTitle">
				<span> 数据统计</span>
				<div class="toggleData" id="toggleData">
					<span class="active">全区数据</span>
					<span>【<span id="today"></span>】当天数据</span>
				</div>
			</div>
			<div class="subContent">
				<div class="left">
					<div class="leftTitle">全区服务数据统计</div>
					<div class="leftContent">
						<div class="card">
							<div class="card_value"><span class="value" id="personCountSum">0</span><span>人</span></div>
							<div><img src="../../images/disabled/tubiao_11.png" alt="">全区总服务人数</div>
						</div>
						<div class="card">
							<div class="card_value"><span class="value" id="personTimeSum">0</span><span>次</span></div>
							<div><img src="../../images/disabled/tubiao_13.png" alt="">全区总服务人次</div>
						</div>
						<div class="card">
							<div class="card_value"><span class="value" id="projectSum">0</span><span>项</span></div>
							<div><img src="../../images/disabled/tubiao_15.png" alt="">全区服务项目总数</div>
						</div>
						<div class="card">
							<div class="card_value"><span class="value" id="totalTimeSum">0</span><span>小时</span></div>
							<div><img src="../../images/disabled/tubiao_21.png" alt="">全区总服务时长</div>
						</div>
						<div class="card">
							<div class="card_value"><span class="value" id="averageTime">0</span><span>小时</span></div>
							<div><img src="../../images/disabled/tubiao_20.png" alt="">全区平均服务时长</div>
						</div>
					</div>
				</div>
				<div class="right">
					<div class="leftTitle">全区最喜爱残疾人项目分析</div>
					<div class="rightContent" id="favorite"></div>
				</div>
			</div>
		</div>
		<div class="analysis">
			<div class="subTitle">残疾人服务内容分析</div>
			<div class="subContent" id="analysis"></div>
		</div>
		<div class="chart">
			<div class="subTitle">全区各类残疾人参与服务率分析</div>
			<div class="subContent" id="disabledCount">
				<!--<div class="left"></div>-->
				<!--<div class="right">-->
					<!--<div class="legend">-->
						<!--<div>-->
							<!--<span class="color color_one">1</span>-->
							<!--<span>言语残疾</span>-->
						<!--</div>-->
						<!--<div>54431人</div>-->
					<!--</div>-->
					<!--<div class="legend">-->
						<!--<div>-->
							<!--<span class="color color_two">2</span>-->
							<!--<span>言语残疾</span>-->
						<!--</div>-->
						<!--<div>54431人</div>-->
					<!--</div>-->
					<!--<div class="legend">-->
						<!--<div>-->
							<!--<span class="color color_three">3</span>-->
							<!--<span>言语残疾</span>-->
						<!--</div>-->
						<!--<div>54431人</div>-->
					<!--</div>-->
					<!--<div class="legend">-->
						<!--<div>-->
							<!--<span class="color color_four">4</span>-->
							<!--<span>言语残疾</span>-->
						<!--</div>-->
						<!--<div>54431人</div>-->
					<!--</div>-->
					<!--<div class="legend">-->
						<!--<div>-->
							<!--<span class="color color_five">5</span>-->
							<!--<span>言语残疾</span>-->
						<!--</div>-->
						<!--<div>54431人</div>-->
					<!--</div>-->
				<!--</div>-->
			</div>
		</div>
	</div>
</div>





<script src="../../js/jquery.min.js"></script>
<script src="../../layui/layui.js"></script>
<script src="../../js/echarts.common.min.js"></script>
<!--<script src="../../js/heightClient.js"></script>-->


<script>
	const now = new Date();
	$("#today").html(` ${now.getMonth()+1}月${now.getDate()}日 `);



	$("#toggleData").on("click","span",function(e) {
		const target = $(e.target);
		if(target.hasClass("active"))
			return false;
		target.addClass("active").siblings().removeClass("active");
		if(target.text() === "全区数据") {
			analysisAll();
			allAreaView();
		} else {
			todayView();
			analysisToday();
		}
	});
	analysisAll();
	allAreaView();
	function allAreaView() {
		$.ajax({
			url: "/api/project/overview1",
			type: "GET",
			data: { district: "雨花台区"},
			success: function(res) {
				if(res ){
					const {data ={}	} = res;
					const keys = ["averageTime","personCountSum","personTimeSum","projectSum","totalTimeSum"];
					keys.forEach(function(item){
						$("#"+item).html(data[item] || 0);
					});
				}
			}

		});
	}

	function todayView() {
		$.ajax({
			url: "/api/project/overview2",
			type: "GET",
			success: function(res) {
				if(res ){
					const {data ={}	} = res;
					const keys = ["averageTime","personCountSum","personTimeSum","projectSum","totalTimeSum"];
					keys.forEach(function(item){
						$("#"+item).html(data[item] || 0);
					});
				}
			}
		});
	}
	function analysisAll() {
		$.ajax({
			url: "/api/project/usersPreferenceAnalysis",
			type: "GET",
			data: { type: "智力残疾"},
			success: function(res) {
				if(res ){
					console.log("/api/project/usersPreferenceAnalysis",res);
					const { data = {}} = res;
					if(JSON.stringify(data) !== "{}") {
						const yData = Object.keys(data);
						const xData = Object.values(data);
						showAnalysisChart(xData,yData);
					}

				}
			}

		});
	}


	function analysisToday() {
		$.ajax({
			url: "/api/project/usersPreferenceAnalysisToday",
			type: "GET",
			data: { type: "智力残疾"},
			success: function(res) {
				if(res ){
//					console.log("/api/project/usersPreferenceAnalysisToday",res);
					const { data = {}} = res;
					if(JSON.stringify(data) !== "{}") {
						const xData = Object.keys(data);
						const yData = Object.values(data);
						showAnalysisChart(xData,yData);
					}
				}
			}

		});
	}



	$.ajax({
		url: "/api/project/overview3",
		type: "GET",
		dataType:"json",
		success: function(res) {
			if(res) {
				const {data = {}} =res;
				const lineData = formatServiceLine(data);
				const legend= {"averageTime":"平均服务时长","personCountSum": "总服务人数","personTimeSum":"总服务人次","totalTimeSum":"总服务时长"};
				const xData = Object.keys(data);
				showLineData(legend,lineData,xData);
			}
		}

	});
	function formatServiceLine(data) {
		const keys = Object.keys(data);
		if(!keys.length) return [];
		const format = {
			"averageTime": [],
			"personCountSum": [],
			"personTimeSum": [],
			"totalTimeSum": []
		};
		return keys.reduce(function(all,item) {
			const value = data[item];
			const subKeys = Object.keys(value);
			subKeys.forEach(function(i) {
				all[i] = all[i].concat(value[i]);
			});
			return all;
		},format);
	}
	function showAnalysisChart(xData,yData) {
		var option = {
//		title: {
//			text: '全区最喜爱残疾人项目分析'
//		},
			xAxis: {
				type: 'value',
				show: false,
				splitLine: {show: false},
				boundaryGap: [0, 0.01]
			},
			yAxis: {
				type: 'category',
				splitLine: {show: false},
				axisLine: {
					lineStyle:{
						width: 0
					}
				},
				axisTick: {
					show: false
				},
//				data: ['跳绳','踢毽子','打球','跑步','其他'].reverse()
				data: yData
			},
			series: [{
				name: 'bar',
				type: 'bar',
				barWidth: 10,
				itemStyle: {
					normal: {
						barBorderRadius: 5,
						color: new echarts.graphic.LinearGradient(
								0, 0, 0, 1,
								[
									{offset: 0, color: '#14c8d4'},
									{offset: 1, color: '#43eec6'}
								]
						)
					}
				},
//				 data: [61, 34, 11, 6, 1].reverse()
				data: xData
			}]
		};
		var myChart = echarts.init(document.getElementById('favorite'));
		myChart.setOption(option);
	}


	function showLineData(legend,data,xData) {
		const keys = Object.keys(data);
		const series = keys.map(function(i) {
			return {
				name: legend[i],
				type:'line',
				stack: '总量',
				data: data[i]
			};
		});
		var option2 = {
			legend: {
				data:Object.values(legend)
			},
			grid: {
				left: '3%',
				right: '4%',
				bottom: '3%',
				containLabel: true
			},
			xAxis: {
				type: 'category',
				boundaryGap: false,
				data: xData
			},
			yAxis: {
				type: 'value'
			},
			series: series
		};
		var myChart = echarts.init(document.getElementById('analysis'));
		myChart.setOption(option2);
	}



	$.ajax({
		url: "/api/user/statisticData",
		type: "GET",
		success: function(res) {
			if(res && res.data ){
				// const { analysis = {},data = {}} = ;
				var data = res.data;
				const x = Object.keys(data);
				const y = x.map(function(item) {
					return data[item];
				});
				analysisService(x,y);
			}
		}

	});
	function analysisService(x,y) {
		var cellSize = [80, 80];
		var option3 = {
			xAxis: {
				type: 'category',
				data: x, // ['精神残疾', '视力残疾', '听力残疾', '言语残疾', '肢体残疾', '智力残疾']
			},
			yAxis: {
				type: 'value'
			},
			series: [{
				data:  y,// [1, 1, 1, 1, 1, 1.5],
				type: 'line'
			}]
		};
		var myChart = echarts.init(document.getElementById('disabledCount'));
		myChart.setOption(option3);
	}

</script>
</body>
</html>